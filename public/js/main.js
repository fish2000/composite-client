define("service/native",["require","exports","module"],function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o})}),define("service/comsock",["require","exports","module"],function(t,e,i){function n(){}e=i.exports=n;var o=0;n.prototype.connect=function(t){if(!t)throw new Error("Please provide a endpoint url to the sockjs server.");this.session=null,this.sessionData=null,this.uuid=null,this.deviceIndex=null,this.sockjs_=new SockJS(t),this.multiplexer_=new WebSocketMultiplex(this.sockjs_),this.channel_=this.multiplexer_.channel("composite"),this.channel_.onmessage=this.messageHandler_.bind(this),this.onMessage=null},n.prototype.messageHandler_=function(t){switch(t=JSON.parse(t.data),console.log("messageHandler_ : ",t),console.log(t),t.type){case"uuid":this.uuid=t.data.uuid,console.log("uuid",this.uuid),console.log(this.uuid);break;case"join":this.createSession(t.data.channel);break;case"session":this.sessionUpdate(t.data);case"payload":this.onMessage&&this.onMessage(t.data)}},n.prototype.sendMessage=function(t){console.log("send message: ",t),this.channel_.send(JSON.stringify(t))},n.prototype.createSession=function(t){console.log("createSession",t),this.session=this.multiplexer_.channel(t),this.session.onmessage=this.messageHandler_.bind(this)},n.prototype.checkDevice=function(t,e){var i=0;if(0==e){if(i=o++,t.deviceA.uuid===this.uuid)return i;if(t.deviceB.uuid===this.uuid)return o++,i+1;o++}else if(i=o++,t.deviceB.uuid===this.uuid)return i;return 0},n.prototype.sessionUpdate=function(t){if(_viewport=document.querySelector(".viewport"),null===this.sessionData){this.sessionData=t;var e,i=t.links,n=i.length;o=0;for(var s=0;n>s;s++){e=i[s];var r=this.checkDevice(e,s);this.deviceIndex=r}console.log("device index: ",this.deviceIndex),_viewport.innerHTML="Device Index: "+this.deviceIndex}this.sessionData=t,this.sessionCallback&&this.sessionCallback(t)}}),define("service/touch",["require","exports","module"],function(t,e,i){function n(t){var e={x:t.clientX||t.changedTouches[0].pageX,y:t.clientY||t.changedTouches[0].pageY};return e}function o(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*i)}var s=function(t){this.target=t,this.onEnter=null,this.onExit=null,this.startPoint=null,this.target.addEventListener("touchstart",this.touchStart.bind(this),!1),this.target.addEventListener("touchmove",this.touchMove.bind(this),!1),this.target.addEventListener("touchend",this.touchEnd.bind(this),!1)};s.YDELTA_THRESHOLD=20,s.prototype.touchStart=function(t){t.preventDefault(),t.stopPropagation();var e=n(t);this.startPoint=e,console.log("touchStart",e),this.onEnter&&this.onEnter(e,e)},s.prototype.touchMove=function(t){t.preventDefault(),t.stopPropagation(),n(t)},s.prototype.touchEnd=function(t){t.preventDefault(),t.stopPropagation();var e=n(t);console.log("touchEnd",e);var i=e.y-this.startPoint.y,r=Math.abs(i);if(r<s.YDELTA_THRESHOLD){var a=e.x-this.startPoint.x;if(this.onExit){o(this.startPoint,e);var c={x:a,y:i};this.onExit(e,c)}}},e=i.exports=s}),define("service/device",["require","exports","module"],function(t,e,i){function n(){this.positionHandler_=this.onPositionChanged.bind(this),this.location=null,this.width=0,this.height=0,this.initialize()}e=i.exports=n,n.prototype.initialize=function(){navigator.geolocation.getCurrentPosition(this.positionHandler_),navigator.geolocation.watchPosition(this.positionHandler_),window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize(null)},n.prototype.onPositionChanged=function(t){this.location=t},n.prototype.onResize=function(){this.width=window.innerWidth,this.height=window.innerHeight}}),define("application",["require","exports","module","service/comsock","service/touch","service/device"],function(t){var e,i,n,o,s=t("service/comsock"),r=t("service/touch"),a=t("service/device"),c=null,h=function(){if(null!==c)throw new Error("Can instantiate through constrsuctor. Use Application.shared()");e=document.querySelector(".viewport")};return Object.defineProperties(h.prototype,{viewport:{get:function(){return e}}}),h.shared=function(){return null===c&&(c=new h),c},h.prototype.initialize=function(){console.log("Application.init"),i=new s,i.connect("/composite"),o=new a(e),n=new r(window),n.onEnter=this.onTouchEnter.bind(this),n.onExit=this.onTouchExit.bind(this)},h.prototype.onTouchEnter=function(t,e){this.sendTouchEvent("enter",t,e)},h.prototype.onTouchExit=function(t,e){this.sendTouchEvent("exit",t,e)},h.prototype.sendTouchEvent=function(t,e,n){var s={uuid:i.uuid,width:o.width,height:o.height};i.sendMessage({type:t,data:{device:s,geo:o.location,entry:[e.x,e.y],vector:[n.x,n.y]}})},h}),require.config({urlArgs:"bust="+(new Date).getTime(),paths:{hogan:"vendor/hogan",text:"vendor/text",hgn:"vendor/hgn",signals:"vendor/signals"},packages:[],shim:{}});var sharedApp=sharedApp||{};define("main",["require","exports","module","service/native","application"],function(t){t("service/native");var e=t("application");sharedApp=e.shared(),sharedApp.initialize()}),require(["main"]);
//@ sourceMappingURL=main.js.map