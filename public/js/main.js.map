{"version":3,"file":"main.js","sources":["../../src/app/service/native.js","../../src/app/service/comsock.js","../../src/app/service/touch.js","../../src/app/service/device.js","../../src/app/application.js","../../src/app/main.js"],"names":[],"mappings":"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","sourcesContent":["\ndefine('service/native',['require','exports','module'],function (require, exports, module) {\n\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n\n    var aArgs = Array.prototype.slice.call(arguments, 1), \n        fToBind = this, \n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP && oThis\n                                 ? this\n                                 : oThis,\n                               aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n\n});","\ndefine('service/comsock',['require','exports','module'],function (require, exports, module) {\n\n\n  exports = module.exports = ComSock;\n\n  var di = 0;\n\n  function ComSock() {\n    \n  };\n\n  ComSock.prototype.connect = function(url) {\n    if (!url) {\n      throw new Error('Please provide a endpoint url to the sockjs server.');\n    }\n\n    this.session = null;\n    this.sessionData = null;\n    this.uuid = null;\n    this.deviceIndex = null;\n    this.sockjs_ = new SockJS(url);\n    this.multiplexer_ = new WebSocketMultiplex(this.sockjs_);\n    this.channel_ = this.multiplexer_.channel('composite');\n\n    this.channel_.onmessage = this.messageHandler_.bind(this);\n    this.onMessage = null;\n\n  };\n\n  ComSock.prototype.messageHandler_ = function(message) {\n\n    message = JSON.parse(message.data);\n    console.log('messageHandler_ : ', message);\n    console.log(message);\n    switch(message.type) {\n      case \"uuid\":\n        this.uuid = message.data.uuid;\n        console.log('uuid', this.uuid);\n        console.log(this.uuid);\n        break;\n      case \"join\":\n        this.createSession(message.data.channel);\n        break;\n      case \"session\":\n        this.sessionUpdate(message.data);\n      case \"payload\":\n        if (this.onMessage) {\n          this.onMessage(message.data);\n        }\n      default:\n        //console.log('connect message:', message);\n        break;\n    }\n  };\n\n\n\n  \n  ComSock.prototype.sendMessage = function(message) {\n    console.log('send message: ', message);\n    this.channel_.send(JSON.stringify(message));\n  };\n\n  ComSock.prototype.createSession = function(session_id) {\n    console.log('createSession', session_id);\n    this.session = this.multiplexer_.channel(session_id);\n    this.session.onmessage = this.messageHandler_.bind(this);\n  };\n\n  ComSock.prototype.checkDevice =function(link, index) {\n    var i=0;\n    if (index==0) {\n      i = di++;\n      if ( link.deviceA.uuid === this.uuid ) {\n        return i;\n      } else if (link.deviceB.uuid === this.uuid ) {\n        di++;\n        return i+1;\n      } else {\n        di ++;\n      }\n    } else {\n      i = di++;\n      if ( link.deviceB.uuid === this.uuid )  {\n        return i;\n      }\n    }\n    return 0;\n  };\n\n  ComSock.prototype.sessionUpdate = function(data) {\n    _viewport = document.querySelector('.viewport');\n    if (this.sessionData === null) {\n      this.sessionData = data;\n      \n      var links = data.links;\n      var len = links.length;\n      var link;\n\n      di=0;\n      for (var i=0; i<len; i++) {\n        link = links[i];\n        var mdi = this.checkDevice(link, i);\n        this.deviceIndex = mdi;\n      }\n      console.log('device index: ', this.deviceIndex);\n      _viewport.innerHTML = 'Device Index: '+ this.deviceIndex;\n    }\n    this.sessionData = data;\n    if (this.sessionCallback) this.sessionCallback(data);\n  };\n\n\n});\n","\ndefine('service/touch',['require','exports','module'],function (require, exports, module) {\n\n  function toPoint(event) {\n    var point = {\n      x: event.clientX || event.changedTouches[0].pageX, \n      y: event.clientY || event.changedTouches[0].pageY\n    };\n    return point;\n  };\n\n\n\n  function distanceBetweenPoints(p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n    return Math.sqrt((dx * dx) + (dy * dx));\n  }\n\n  var Touch = function(target) {\n    this.target = target;\n    this.onEnter = null;\n    this.onExit = null;\n    this.startPoint = null;\n    this.target.addEventListener('touchstart', this.touchStart.bind(this), false);\n    this.target.addEventListener('touchmove', this.touchMove.bind(this), false);\n    this.target.addEventListener('touchend', this.touchEnd.bind(this), false);\n  };\n\n  Touch.YDELTA_THRESHOLD = 20;\n\n  Touch.prototype.touchStart = function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var point = toPoint(event);\n\n    this.startPoint = point;\n    console.log('touchStart', point);\n    if (this.onEnter) {\n      this.onEnter(point, point);\n    }\n  };\n\n  Touch.prototype.touchMove = function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var point = toPoint(event);\n    //console.log('touchMove', point);\n  };\n\n  Touch.prototype.touchEnd = function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var point = toPoint(event);\n    console.log('touchEnd', point);\n\n    var dy = point.y - this.startPoint.y;\n    var aby = Math.abs(dy);\n     \n    if (aby < Touch.YDELTA_THRESHOLD) {\n      var dx = point.x - this.startPoint.x;\n      if (this.onExit) {\n        var dist = distanceBetweenPoints(this.startPoint, point);\n        var mag = {x: dx, y: dy};\n\n        this.onExit(point, mag);\n      }\n    }\n    \n  };\n\n\n\n\n\n\n\n\n\n\n    \n\n\n\n    \n    exports = module.exports = Touch;\n});","\ndefine('service/device',['require','exports','module'],function (require, exports, module) {\n\n  /**\n   * Assigns the module as a Device object.\n   * @suppress {checkTypes}\n   */\n  exports = module.exports = Device;\n\n  function Device(context) {\n    this.positionHandler_  = this.onPositionChanged.bind(this);\n    this.location = null;\n    this.width = 0;\n    this.height = 0;\n    this.initialize();\n  };\n\n  Device.prototype.initialize = function() {\n    navigator.geolocation.getCurrentPosition(this.positionHandler_);\n    navigator.geolocation.watchPosition(this.positionHandler_);\n\n    window.addEventListener('resize', this.onResize.bind(this), false);\n    this.onResize(null);\n\n  };\n\n  Device.prototype.onPositionChanged = function(location) {\n    this.location = location;\n  };\n\n  Device.prototype.onResize = function(event) {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n  };\n\n\n\n});","\ndefine('application',['require','exports','module','service/comsock','service/touch','service/device'],function (require, exports, module) {\n\n  var ComSock = require('service/comsock');\n  var Touch = require('service/touch');\n  var Device = require('service/device');\n\n  var _instance = null;\n  var _viewport;\n\n  var comSock;\n  var _touch;\n  var _device;\n\n  var Application = function() {\n    if (_instance !== null) {\n      throw new Error('Can instantiate through constrsuctor. Use Application.shared()');\n    }\n    _viewport = document.querySelector('.viewport');\n  };\n\n  Object.defineProperties(Application.prototype, {\n      viewport : {\n        get: function() {\n          return _viewport;\n        }\n      }\n  });\n\n  Application.shared = function() {\n    if (_instance === null) {\n      _instance = new Application();\n    }\n    return _instance;\n  };\n\n  Application.prototype.initialize = function() {\n    console.log('Application.init');\n\n\n    comSock = new ComSock();\n    comSock.connect('/composite');\n\n    _device = new Device(_viewport);\n\n    _touch = new Touch(window);\n    _touch.onEnter = this.onTouchEnter.bind(this);\n    _touch.onExit = this.onTouchExit.bind(this);\n  };\n\n  Application.prototype.onTouchEnter = function(point, magnitude) {\n    this.sendTouchEvent('enter', point, magnitude);\n  };\n\n  Application.prototype.onTouchExit = function(point, magnitude) {\n    this.sendTouchEvent('exit', point, magnitude);\n  };\n\n  Application.prototype.sendTouchEvent = function(type, point, magnitude) {\n    var devObj = {\n      uuid : comSock.uuid,\n      width : _device.width,\n      height : _device.height\n    };\n    comSock.sendMessage({\n                          type: type,\n                          data: { \n                            device:devObj,\n                            geo:_device.location,\n                            entry:[point.x, point.y],\n                            vector:[magnitude.x, magnitude.y]\n                          }\n                        });\n  }\n\n  return Application;\n});","\nrequire.config({\n  urlArgs: \"bust=\" +  (new Date()).getTime(),\n  paths: {\n    'hogan' : 'vendor/hogan',\n    'text' : 'vendor/text',\n    'hgn' : 'vendor/hgn',\n    'signals' : 'vendor/signals'\n  },\n  packages: [],\n\tshim: {}\n});\n\n//A Comment\nvar sharedApp = sharedApp || {};\n\ndefine('main',['require','exports','module','service/native','application'],function (require, exports, module) {\n  require('service/native');\n  var Application = require('application');\n  sharedApp = Application.shared();\n  sharedApp.initialize();\n\n});\n"]}